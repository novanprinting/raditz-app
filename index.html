<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RADITZ OJOL PRO</title>
    <style>
        :root {
            --primary: #1e88e5;
            --success: #2e7d32;
            --danger: #d32f2f;
            --bg: #f0f2f5;
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); padding-bottom: 80px; color: #333; }
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; font-weight: bold; position: sticky; top:0; z-index: 10; }
        .container { padding: 12px; max-width: 500px; margin: auto; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        h3 { margin: 0 0 10px 0; font-size: 1rem; color: var(--primary); border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        input, select, button { width: 100%; padding: 12px; margin-top: 8px; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 14px; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        .grid-db { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-box { padding: 10px; border-radius: 10px; text-align: center; }
        .blue { background: #e3f2fd; } .green { background: #e8f5e9; } .orange { background: #fff3e0; }
        
        .navbar { position: fixed; bottom: 0; width: 100%; display: flex; background: white; border-top: 1px solid #ddd; height: 65px; }
        .navbar button { flex: 1; background: none; color: #777; border: none; padding: 0; margin: 0; border-radius: 0; }
        .navbar button.active { color: var(--primary); }

        .sync-status { font-size: 0.7rem; text-align: center; margin-top: 5px; color: #888; }
    </style>
</head>
<body>

<div class="header">RADITZ OJOL PRO</div>

<div class="container">
    <div id="page0" class="page active">
        <div class="card">
            <h3>üìÖ Filter & Rekap Real-Time</h3>
            <input type="date" id="filterTanggal" onchange="updateDashboard()">
            <div class="grid-db" style="margin-top:15px">
                <div class="stat-box blue">
                    <small>Harian</small>
                    <b id="dbHarian" style="display:block">Rp 0</b>
                </div>
                <div class="stat-box blue">
                    <small>Mingguan</small>
                    <b id="dbMingguan" style="display:block">Rp 0</b>
                </div>
                <div class="stat-box blue">
                    <small>Bulanan</small>
                    <b id="dbBulanan" style="display:block">Rp 0</b>
                </div>
                <div class="stat-box blue">
                    <small>Tahunan</small>
                    <b id="dbTahunan" style="display:block">Rp 0</b>
                </div>
            </div>
        </div>

        <div class="card green">
            <h3>üè¶ Total Tabungan</h3>
            <h2 id="dbTabungan" style="margin:5px 0">Rp 0</h2>
            <small>Terakumulasi dari 30% pendapatan</small>
        </div>

        <div class="card orange">
            <h3>üè† Saldo Kebutuhan</h3>
            <h2 id="dbKebutuhan" style="margin:5px 0">Rp 0</h2>
            <small>Siap digunakan untuk pengeluaran harian</small>
        </div>
        <div class="sync-status" id="syncStatus">Data tersimpan di perangkat</div>
    </div>

    <div id="page1" class="page">
        <div class="card">
            <h3>üöó Order Baru</h3>
            <input type="text" id="custName" placeholder="Nama Pelanggan">
            <input type="number" id="dist" placeholder="Jarak (km)">
            <button onclick="addOrder()">Simpan ke Cloud</button>
        </div>
    </div>

    <div id="page2" class="page">
        <div class="card">
            <h3>üí∞ Pendapatan Lain / Bonus</h3>
            <input type="number" id="inNominal" placeholder="Nominal (Rp)">
            <input type="text" id="inNote" placeholder="Catatan (misal: Tip/Bonus)">
            <button style="background:var(--success)" onclick="addExtra('IN')">Tambah Pendapatan</button>
        </div>
        <div class="card">
            <h3>üí∏ Pengeluaran Harian</h3>
            <input type="number" id="outNominal" placeholder="Nominal (Rp)">
            <input type="text" id="outNote" placeholder="Catatan (misal: Makan/Bensin)">
            <button style="background:var(--danger)" onclick="addExtra('OUT')">Catat Pengeluaran</button>
        </div>
    </div>

    <div id="page3" class="page">
        <div class="card" style="text-align: center;">
            <h3>üè¶ Rekap Tabungan</h3>
            <h1 id="tabTotal">Rp 0</h1>
            <p>Tabungan Anda otomatis terpotong 30% dari setiap penghasilan.</p>
            <button onclick="window.open('URL_GOOGLE_SHEET_ANDA', '_blank')" style="background:#4caf50">Buka Rekap di Google Sheets</button>
        </div>
    </div>
</div>

<div class="navbar">
    <button onclick="showPage(0, this)" class="active">üè† Dashboard</button>
    <button onclick="showPage(1, this)">üöó Order</button>
    <button onclick="showPage(2, this)">üí∞ Keuangan</button>
    <button onclick="showPage(3, this)">üè¶ Tabungan</button>
</div>

<script>
    // --- KONFIGURASI ---
    const SCRIPT_URL = "URL_APPS_SCRIPT_ANDA"; // Ganti dengan URL dari Google Apps Script
    
    let db = JSON.parse(localStorage.getItem('ojol_db')) || {
        transaksi: [], // Gabungan semua: order, in, out
        saldoKebutuhan: 0,
        saldoTabungan: 0,
        saldoPerawatan: 0
    };

    function showPage(num, btn) {
        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        document.querySelectorAll(".navbar button").forEach(b => b.classList.remove("active"));
        document.getElementById("page" + num).classList.add("active");
        btn.classList.add("active");
        updateDashboard();
    }

    function saveDB() {
        localStorage.setItem('ojol_db', JSON.stringify(db));
        updateDashboard();
        syncToCloud();
    }

    function addOrder() {
        let name = document.getElementById('custName').value;
        let dist = parseFloat(document.getElementById('dist').value);
        if(!name || isNaN(dist)) return;

        let total = (dist <= 2) ? 5000 : 5000 + ((dist - 2) * 2000);
        
        let trx = {
            id: Date.now(),
            tgl: new Date().toISOString(),
            jenis: 'ORDER',
            keterangan: 'Order: ' + name,
            masuk: total,
            keluar: 0
        };

        db.transaksi.push(trx);
        db.saldoKebutuhan += (total * 0.5);
        db.saldoTabungan += (total * 0.3);
        db.saldoPerawatan += (total * 0.2);
        
        document.getElementById('custName').value = "";
        document.getElementById('dist').value = "";
        saveDB();
        alert("Order disimpan!");
    }

    function addExtra(type) {
        let nom = parseFloat(document.getElementById(type === 'IN' ? 'inNominal' : 'outNominal').value);
        let note = document.getElementById(type === 'IN' ? 'inNote' : 'outNote').value;
        if(isNaN(nom)) return;

        let trx = {
            id: Date.now(),
            tgl: new Date().toISOString(),
            jenis: type === 'IN' ? 'EXTRA' : 'EXPENSE',
            keterangan: note || (type === 'IN' ? 'Pendapatan Lain' : 'Pengeluaran'),
            masuk: type === 'IN' ? nom : 0,
            keluar: type === 'OUT' ? nom : 0
        };

        if(type === 'IN') {
            db.saldoKebutuhan += (nom * 0.5);
            db.saldoTabungan += (nom * 0.3);
            db.saldoPerawatan += (nom * 0.2);
        } else {
            if(nom > db.saldoKebutuhan) return alert("Saldo kebutuhan tidak cukup!");
            db.saldoKebutuhan -= nom;
        }

        db.transaksi.push(trx);
        document.getElementById(type === 'IN' ? 'inNominal' : 'outNominal').value = "";
        document.getElementById(type === 'IN' ? 'inNote' : 'outNote').value = "";
        saveDB();
    }

    function updateDashboard() {
        let filter = document.getElementById('filterTanggal').value;
        let refDate = filter ? new Date(filter) : new Date();
        
        const isSameDay = (d1, d2) => d1.toDateString() === d2.toDateString();
        const isSameWeek = (d1, d2) => {
            let oneJan = new Date(d1.getFullYear(),0,1);
            let week1 = Math.ceil((((d1 - oneJan) / 86400000) + oneJan.getDay() + 1) / 7);
            let week2 = Math.ceil((((d2 - oneJan) / 86400000) + oneJan.getDay() + 1) / 7);
            return week1 === week2 && d1.getFullYear() === d2.getFullYear();
        };

        let harian = 0, mingguan = 0, bulanan = 0, tahunan = 0;

        db.transaksi.forEach(t => {
            let tDate = new Date(t.tgl);
            if(t.masuk > 0) {
                if(isSameDay(tDate, refDate)) harian += t.masuk;
                if(isSameWeek(tDate, refDate)) mingguan += t.masuk;
                if(tDate.getMonth() === refDate.getMonth() && tDate.getFullYear() === refDate.getFullYear()) bulanan += t.masuk;
                if(tDate.getFullYear() === refDate.getFullYear()) tahunan += t.masuk;
            }
        });

        document.getElementById('dbHarian').innerText = "Rp " + harian.toLocaleString();
        document.getElementById('dbMingguan').innerText = "Rp " + mingguan.toLocaleString();
        document.getElementById('dbBulanan').innerText = "Rp " + bulanan.toLocaleString();
        document.getElementById('dbTahunan').innerText = "Rp " + tahunan.toLocaleString();
        
        document.getElementById('dbTabungan').innerText = "Rp " + db.saldoTabungan.toLocaleString();
        document.getElementById('dbKebutuhan').innerText = "Rp " + db.saldoKebutuhan.toLocaleString();
        document.getElementById('tabTotal').innerText = "Rp " + db.saldoTabungan.toLocaleString();
    }

    function syncToCloud() {
        if(SCRIPT_URL === "https://script.google.com/macros/s/AKfycbyuvdVKOY7JAvcVRlzW_EVa9kBT2DZwSKqk2-zEvQa8vD4BESd02KtGy5IGhnau4JbiOw/exec") return;
        document.getElementById('syncStatus').innerText = "Sinkronisasi ke Google Sheets...";
        
        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(db.transaksi[db.transaksi.length - 1])
        }).then(() => {
            document.getElementById('syncStatus').innerText = "‚úì Terhubung ke Google Sheet";
        }).catch(() => {
            document.getElementById('syncStatus').innerText = "‚ö†Ô∏è Gagal Sync (Offline)";
        });
    }

    // Set default tanggal filter hari ini
    document.getElementById('filterTanggal').valueAsDate = new Date();
    updateDashboard();
</script>

</body>
</html>
